<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login â€¢ ComissÃµes</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body data-theme="light">
  <div class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-5xl grid grid-cols-1 lg:grid-cols-12 gap-4">
      <div class="lg:col-span-5 glass p-6">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-2xl font-black">Dashboard de ComissÃµes</div>
            <div class="text-sm muted">ADM vÃª tudo â€¢ Consultor vÃª sÃ³ o dele</div>
          </div>
          <button id="btnTheme" class="btn">ðŸŒ™</button>
        </div>

        <form id="loginForm" class="mt-6 space-y-3">
          <div>
            <label class="text-xs font-black muted">Entrar como</label>
            <select id="mode" class="select mt-1">
              <option value="admin">Administrador</option>
              <option value="consultor">Consultor</option>
            </select>
          </div>

          <div id="consultorBox" style="display:none;">
            <label class="text-xs font-black muted">Qual consultor?</label>
            <select id="consultorSelect" class="select mt-1">
              <option value="graziele">Graziele</option>
              <option value="pedro">Pedro</option>
              <option value="gustavo">Gustavo</option>
              <option value="poli">Poli</option>
              <option value="victor">Victor</option>
            </select>
          </div>

          <div>
            <label class="text-xs font-black muted">Senha</label>
            <input id="password" class="input mt-1" type="password" placeholder="Digite a senha" required />
            <div class="text-xs muted mt-1">ADM: <b>victor Ã© lindo</b> â€¢ Consultor padrÃ£o: <b>1234</b></div>
          </div>

          <p id="loginErr" class="text-sm" style="display:none; color: var(--bad); font-weight:900;"></p>

          <button class="btn btn-primary w-full">Entrar</button>
        </form>
      </div>

      <div class="lg:col-span-7 panel p-6">
        <div class="text-xl font-black">Como funciona</div>
        <ul class="mt-4 space-y-2 text-sm muted">
          <li>â€¢ Tudo salva no arquivo <b>data.json</b>.</li>
          <li>â€¢ Consultor nÃ£o vÃª nem edita vendas de outros.</li>
          <li>â€¢ Admin vÃª tudo e pode tudo.</li>
        </ul>
      </div>
    </div>
  </div>

<script>
const THEME_KEY = "dash_theme_v1";
function setTheme(t){
  document.body.setAttribute("data-theme", t);
  localStorage.setItem(THEME_KEY, t);
  document.getElementById("btnTheme").textContent = (t==="dark") ? "â˜€ï¸" : "ðŸŒ™";
}
(function initTheme(){
  const saved = localStorage.getItem(THEME_KEY);
  if(saved) return setTheme(saved);
  const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
  setTheme(prefersDark ? "dark" : "light");
})();
document.getElementById("btnTheme").addEventListener("click", ()=>{
  const cur = document.body.getAttribute("data-theme");
  setTheme(cur==="dark" ? "light" : "dark");
});

const mode = document.getElementById("mode");
const consultorBox = document.getElementById("consultorBox");
mode.addEventListener("change", ()=> consultorBox.style.display = mode.value==="consultor" ? "block" : "none");
mode.dispatchEvent(new Event("change"));

document.getElementById("loginForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const loginErr = document.getElementById("loginErr");
  loginErr.style.display = "none";

  const m = mode.value;
  const username = (m==="admin") ? "admin" : document.getElementById("consultorSelect").value;
  const password = document.getElementById("password").value;

  const res = await fetch("/api/login", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ username, password })
  });

  const data = await res.json().catch(()=>({}));
  if(!res.ok){
    loginErr.textContent = data?.error || "Erro ao logar";
    loginErr.style.display = "block";
    return;
  }
  window.location.href = "/dashboard.html";
});
</script>
</body>
</html>
